# Shipping & Orders System - Complete Flow Diagram

## ğŸ”„ User Journey Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CUSTOMER JOURNEY                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. BROWSE PRODUCTS (No Login Required)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Visit /shop     â”‚
   â”‚  View Products   â”‚
   â”‚  No Auth Needed  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Add to Cart     â”‚
   â”‚  (Redux State)   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  View Cart       â”‚
   â”‚  /cart           â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼

2. CHECKOUT (Login/Signup Required)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Click "Go to Checkout"          â”‚
   â”‚  Redirect to /checkout           â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  CHECKOUT PAGE                   â”‚
   â”‚  â”œâ”€ Contact Information          â”‚
   â”‚  â”‚  â”œâ”€ Full Name                 â”‚
   â”‚  â”‚  â”œâ”€ Email                     â”‚
   â”‚  â”‚  â””â”€ Phone                     â”‚
   â”‚  â”‚                               â”‚
   â”‚  â”œâ”€ Shipping Address             â”‚
   â”‚  â”‚  â”œâ”€ Address Line 1            â”‚
   â”‚  â”‚  â”œâ”€ Address Line 2 (optional) â”‚
   â”‚  â”‚  â”œâ”€ City                      â”‚
   â”‚  â”‚  â”œâ”€ State/Province            â”‚
   â”‚  â”‚  â”œâ”€ Postal Code               â”‚
   â”‚  â”‚  â””â”€ Country                   â”‚
   â”‚  â”‚                               â”‚
   â”‚  â””â”€ Order Summary                â”‚
   â”‚     â”œâ”€ Items                     â”‚
   â”‚     â”œâ”€ Subtotal                  â”‚
   â”‚     â””â”€ Total                     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼ (Form Validation)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  POST /api/checkout              â”‚
   â”‚  â”œâ”€ Items                        â”‚
   â”‚  â”œâ”€ Shipping Address             â”‚
   â”‚  â””â”€ Customer Email               â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼

3. PAYMENT (Stripe)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Stripe Checkout Session         â”‚
   â”‚  â”œâ”€ Line Items                   â”‚
   â”‚  â”œâ”€ Customer Email               â”‚
   â”‚  â””â”€ Success/Cancel URLs          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Customer Enters Card Details    â”‚
   â”‚  â”œâ”€ Card Number                  â”‚
   â”‚  â”œâ”€ Expiry                       â”‚
   â”‚  â”œâ”€ CVC                          â”‚
   â”‚  â””â”€ Billing Address              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼ (Payment Processed)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Stripe Webhook                  â”‚
   â”‚  â”œâ”€ Payment Successful           â”‚
   â”‚  â”œâ”€ Update Order Status â†’ "paid" â”‚
   â”‚  â””â”€ Send Confirmation Email      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼

4. ORDER SUCCESS
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  /order-success?session_id=...   â”‚
   â”‚  â”œâ”€ Order Details                â”‚
   â”‚  â”‚  â”œâ”€ Order ID                  â”‚
   â”‚  â”‚  â”œâ”€ Total Amount              â”‚
   â”‚  â”‚  â””â”€ Items                     â”‚
   â”‚  â”‚                               â”‚
   â”‚  â”œâ”€ Shipping Address             â”‚
   â”‚  â”‚  â”œâ”€ Full Name                 â”‚
   â”‚  â”‚  â”œâ”€ Complete Address          â”‚
   â”‚  â”‚  â”œâ”€ Phone                     â”‚
   â”‚  â”‚  â””â”€ Email                     â”‚
   â”‚  â”‚                               â”‚
   â”‚  â””â”€ Next Steps Info              â”‚
   â”‚     â”œâ”€ Confirmation Email        â”‚
   â”‚     â”œâ”€ Tracking Info             â”‚
   â”‚     â””â”€ Account Link              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼

5. USER ACCOUNT
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  /account/profile                â”‚
   â”‚  â”œâ”€ Profile Tab                  â”‚
   â”‚  â”œâ”€ My Orders Tab                â”‚
   â”‚  â”‚  â”œâ”€ Order List                â”‚
   â”‚  â”‚  â”‚  â”œâ”€ Order ID               â”‚
   â”‚  â”‚  â”‚  â”œâ”€ Status                 â”‚
   â”‚  â”‚  â”‚  â”œâ”€ Shipping Address       â”‚
   â”‚  â”‚  â”‚  â””â”€ Total                  â”‚
   â”‚  â”‚  â”‚                            â”‚
   â”‚  â”‚  â””â”€ View Details Link         â”‚
   â”‚  â”‚                               â”‚
   â”‚  â”œâ”€ Addresses Tab                â”‚
   â”‚  â””â”€ Security Tab                 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Admin Order Management Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ADMIN DASHBOARD                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. LOGIN
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  /signin         â”‚
   â”‚  Admin Email     â”‚
   â”‚  Admin Password  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼

2. ORDERS LIST
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  /admin/orders                   â”‚
   â”‚                                  â”‚
   â”‚  â”Œâ”€ Order Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
   â”‚  â”‚ Order #1                      â”‚â”‚
   â”‚  â”‚ Customer: John Doe            â”‚â”‚
   â”‚  â”‚ Date: Nov 29, 2024            â”‚â”‚
   â”‚  â”‚ Status: pending               â”‚â”‚
   â”‚  â”‚ Total: $59.98                 â”‚â”‚
   â”‚  â”‚                               â”‚â”‚
   â”‚  â”‚ Items:                        â”‚â”‚
   â”‚  â”‚ â”œâ”€ Product 1 Ã— 2              â”‚â”‚
   â”‚  â”‚ â””â”€ Product 2 Ã— 1              â”‚â”‚
   â”‚  â”‚                               â”‚â”‚
   â”‚  â”‚ Shipping To:                  â”‚â”‚
   â”‚  â”‚ â”œâ”€ John Doe                   â”‚â”‚
   â”‚  â”‚ â”œâ”€ 123 Main Street            â”‚â”‚
   â”‚  â”‚ â”œâ”€ New York, NY 10001         â”‚â”‚
   â”‚  â”‚ â””â”€ Phone: +1234567890         â”‚â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
   â”‚                                  â”‚
   â”‚  â”Œâ”€ Order Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
   â”‚  â”‚ Order #2                      â”‚â”‚
   â”‚  â”‚ ... (more orders)             â”‚â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼

3. ORDER DETAILS
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  /admin/orders/[id]              â”‚
   â”‚                                  â”‚
   â”‚  â”Œâ”€ Order Items â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
   â”‚  â”‚ Product 1                     â”‚â”‚
   â”‚  â”‚ $29.99 Ã— 2 = $59.98           â”‚â”‚
   â”‚  â”‚ [Image]                       â”‚â”‚
   â”‚  â”‚                               â”‚â”‚
   â”‚  â”‚ Total: $59.98                 â”‚â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
   â”‚                                  â”‚
   â”‚  â”Œâ”€ Shipping Address â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
   â”‚  â”‚ John Doe                      â”‚â”‚
   â”‚  â”‚ 123 Main Street               â”‚â”‚
   â”‚  â”‚ Apt 4B                        â”‚â”‚
   â”‚  â”‚ New York, NY 10001            â”‚â”‚
   â”‚  â”‚ United States                 â”‚â”‚
   â”‚  â”‚ Phone: +1234567890            â”‚â”‚
   â”‚  â”‚ Email: john@example.com       â”‚â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
   â”‚                                  â”‚
   â”‚  â”Œâ”€ Order Status â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
   â”‚  â”‚ Current: pending              â”‚â”‚
   â”‚  â”‚                               â”‚â”‚
   â”‚  â”‚ Update Status:                â”‚â”‚
   â”‚  â”‚ [Dropdown â–¼]                  â”‚â”‚
   â”‚  â”‚ â”œâ”€ pending                    â”‚â”‚
   â”‚  â”‚ â”œâ”€ paid                       â”‚â”‚
   â”‚  â”‚ â”œâ”€ processing                 â”‚â”‚
   â”‚  â”‚ â”œâ”€ shipped                    â”‚â”‚
   â”‚  â”‚ â”œâ”€ delivered                  â”‚â”‚
   â”‚  â”‚ â””â”€ cancelled                  â”‚â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
   â”‚                                  â”‚
   â”‚  â”Œâ”€ Customer Info â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
   â”‚  â”‚ Name: John Doe                â”‚â”‚
   â”‚  â”‚ Email: john@example.com       â”‚â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼

4. UPDATE STATUS
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Select New Status               â”‚
   â”‚  â”œâ”€ pending â†’ paid               â”‚
   â”‚  â”œâ”€ paid â†’ processing            â”‚
   â”‚  â”œâ”€ processing â†’ shipped         â”‚
   â”‚  â”œâ”€ shipped â†’ delivered          â”‚
   â”‚  â””â”€ any â†’ cancelled              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  PATCH /api/admin/orders/[id]    â”‚
   â”‚  { status: "processing" }        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Status Updated                  â”‚
   â”‚  Order #1: pending â†’ processing  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ Database Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATABASE OPERATIONS                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. CREATE ORDER
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  POST /api/checkout              â”‚
   â”‚  â”œâ”€ Validate Shipping Address    â”‚
   â”‚  â”œâ”€ Create Stripe Session        â”‚
   â”‚  â””â”€ Create Order Record          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  INSERT INTO Order               â”‚
   â”‚  â”œâ”€ userId (optional)            â”‚
   â”‚  â”œâ”€ totalAmount                  â”‚
   â”‚  â”œâ”€ stripeSessionId              â”‚
   â”‚  â”œâ”€ status: "pending"            â”‚
   â”‚  â”œâ”€ customerEmail                â”‚
   â”‚  â”œâ”€ shippingAddress (JSON)       â”‚
   â”‚  â””â”€ createdAt                    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  INSERT INTO OrderItem (multiple)â”‚
   â”‚  â”œâ”€ orderId                      â”‚
   â”‚  â”œâ”€ productId                    â”‚
   â”‚  â”œâ”€ name                         â”‚
   â”‚  â”œâ”€ unitPrice                    â”‚
   â”‚  â”œâ”€ quantity                     â”‚
   â”‚  â””â”€ imageUrl                     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. PAYMENT WEBHOOK
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Stripe Webhook Event            â”‚
   â”‚  checkout.session.completed      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  UPDATE Order                    â”‚
   â”‚  WHERE stripeSessionId = ...     â”‚
   â”‚  SET status = "paid"             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. FETCH ORDERS
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  GET /api/orders                 â”‚
   â”‚  (Authenticated User)            â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  SELECT * FROM Order             â”‚
   â”‚  WHERE userId = ?                â”‚
   â”‚  INCLUDE OrderItems              â”‚
   â”‚  ORDER BY createdAt DESC         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Return Orders with:             â”‚
   â”‚  â”œâ”€ Order Details                â”‚
   â”‚  â”œâ”€ Shipping Address             â”‚
   â”‚  â””â”€ Order Items                  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. ADMIN FETCH ALL ORDERS
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  GET /api/admin/orders           â”‚
   â”‚  (Admin Only)                    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  SELECT * FROM Order             â”‚
   â”‚  INCLUDE User, OrderItems        â”‚
   â”‚  ORDER BY createdAt DESC         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Return All Orders with:         â”‚
   â”‚  â”œâ”€ Customer Info                â”‚
   â”‚  â”œâ”€ Shipping Address             â”‚
   â”‚  â”œâ”€ Order Items                  â”‚
   â”‚  â””â”€ Status                       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Data Structure

### Order Record (Database)
```
Order {
  id: 1
  userId: 5 (or null for guest)
  totalAmount: 59.98
  currency: "usd"
  stripeSessionId: "cs_test_..."
  stripePaymentIntentId: "pi_test_..."
  status: "pending" | "paid" | "processing" | "shipped" | "delivered" | "cancelled"
  customerEmail: "john@example.com"
  shippingAddress: {
    fullName: "John Doe"
    email: "john@example.com"
    phone: "+1234567890"
    addressLine1: "123 Main Street"
    addressLine2: "Apt 4B"
    city: "New York"
    state: "NY"
    postalCode: "10001"
    country: "US"
  }
  createdAt: 2024-11-29T10:30:00Z
  updatedAt: 2024-11-29T10:35:00Z
  
  items: [
    {
      id: 1
      orderId: 1
      productId: 5
      name: "Cleaning Spray"
      unitPrice: 29.99
      quantity: 2
      imageUrl: "..."
    }
  ]
}
```

---

## ğŸ”„ Status Progression

```
Order Lifecycle:

pending (Initial State)
   â”‚
   â”œâ”€ Payment Fails â†’ Remains pending
   â”‚
   â””â”€ Payment Succeeds
      â”‚
      â–¼
   paid (Webhook Updates)
      â”‚
      â”œâ”€ Admin Reviews
      â”‚
      â–¼
   processing (Admin Action)
      â”‚
      â”œâ”€ Prepare for Shipment
      â”‚
      â–¼
   shipped (Admin Action)
      â”‚
      â”œâ”€ In Transit
      â”‚
      â–¼
   delivered (Admin Action)
      â”‚
      â””â”€ Order Complete

Alternative Path:
Any Status â†’ cancelled (Admin Action)
```

---

## ğŸ¯ Key Integration Points

```
Frontend â†â†’ Backend â†â†’ Database
   â”‚           â”‚           â”‚
   â”œâ”€ /checkout â”€â†’ POST /api/checkout â”€â†’ Create Order
   â”‚           â”‚           â”‚
   â”œâ”€ /order-success â”€â†’ GET /api/orders?sessionId â”€â†’ Fetch Order
   â”‚           â”‚           â”‚
   â”œâ”€ /account/profile â”€â†’ GET /api/orders â”€â†’ Fetch User Orders
   â”‚           â”‚           â”‚
   â”œâ”€ /admin/orders â”€â†’ GET /api/admin/orders â”€â†’ Fetch All Orders
   â”‚           â”‚           â”‚
   â””â”€ /admin/orders/[id] â”€â†’ PATCH /api/admin/orders/[id] â”€â†’ Update Status
```

---

## ğŸ“± Responsive Design

```
Desktop (1024px+)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Checkout Form | Order Summary       â”‚
â”‚ (2/3 width)   | (1/3 width)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Tablet (768px - 1023px)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Checkout Form                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Order Summary                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Mobile (< 768px)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Checkout Form                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Order Summary                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… Validation Flow

```
User Input
   â”‚
   â–¼
Frontend Validation
   â”œâ”€ Full Name: min 2 chars
   â”œâ”€ Email: valid format
   â”œâ”€ Phone: min 10 chars
   â”œâ”€ Address: min 5 chars
   â”œâ”€ City: min 2 chars
   â”œâ”€ State: min 2 chars
   â”œâ”€ Postal Code: min 3 chars
   â””â”€ Country: required
   â”‚
   â”œâ”€ Invalid â†’ Show Error Message
   â”‚
   â””â”€ Valid
      â”‚
      â–¼
   Backend Validation (Zod Schema)
      â”œâ”€ Re-validate all fields
      â”œâ”€ Sanitize input
      â””â”€ Check for injection attacks
      â”‚
      â”œâ”€ Invalid â†’ Return 400 Error
      â”‚
      â””â”€ Valid
         â”‚
         â–¼
      Create Order & Stripe Session
```

